openapi: 3.1.0
info:
  title: Payment Authorization Service
  description: |
    Authorizes payment transfers for processed insurance claims.

    Authorization rules:
    - totalPayment > 0 AND bankAccount is not blank → AUTHORIZED
    - Otherwise → DENIED

    On authorization, a unique AUTH code is issued for audit trail purposes.
  version: 1.0.0
  contact:
    name: Insurance Claim Processing System

servers:
  - url: http://localhost:8088
    description: Local development server

tags:
  - name: Payment Authorization
    description: Operations for authorizing claim payments

paths:
  /payments/authorize:
    post:
      tags:
        - Payment Authorization
      summary: Authorize a claim payment
      description: |
        Validates and authorizes a payment transfer for a processed insurance claim.
        Returns an authorization ID and code upon success, or a denial reason
        if the payment conditions are not met.
      operationId: authorizePayment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentAuthorizationRequest'
            examples:
              authorizedPayment:
                summary: Valid payment authorization request
                value:
                  claimId: "CLM-2024-001"
                  totalPayment: 30380.0
                  policyNumber: "POL-123456"
                  bankAccount: "FR7630006000011234567890189"
              deniedPayment:
                summary: Denied payment - zero amount
                value:
                  claimId: "CLM-2024-001"
                  totalPayment: 0.0
                  policyNumber: "POL-123456"
                  bankAccount: "FR7630006000011234567890189"
      responses:
        '200':
          description: Authorization decision returned (AUTHORIZED or DENIED)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentAuthorizationResponse'
              examples:
                authorized:
                  summary: Payment authorized
                  value:
                    authorizationId: "c3d4e5f6-a7b8-9012-cdef-123456789012"
                    claimId: "CLM-2024-001"
                    status: "AUTHORIZED"
                    authorizationCode: "AUTH-045231"
                    message: "Payment of $30380.00 authorized for claim CLM-2024-001."
                denied:
                  summary: Payment denied
                  value:
                    authorizationId: "d4e5f6a7-b8c9-0123-def0-234567890123"
                    claimId: "CLM-2024-001"
                    status: "DENIED"
                    authorizationCode: "N/A"
                    message: "Payment denied: total payment amount must be greater than zero."
        '400':
          description: Invalid request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    PaymentAuthorizationRequest:
      type: object
      required:
        - claimId
        - totalPayment
        - policyNumber
        - bankAccount
      properties:
        claimId:
          type: string
          description: The claim for which payment is being authorized
          example: "CLM-2024-001"
        totalPayment:
          type: number
          format: double
          description: Total payment amount to transfer in USD
          minimum: 0
          example: 30380.0
        policyNumber:
          type: string
          description: Policy number associated with the claim
          example: "POL-123456"
        bankAccount:
          type: string
          description: Destination bank account number or IBAN for the transfer
          example: "FR7630006000011234567890189"

    PaymentAuthorizationResponse:
      type: object
      properties:
        authorizationId:
          type: string
          format: uuid
          description: Unique identifier for this authorization record
        claimId:
          type: string
          description: The claim ID that was processed
        status:
          type: string
          description: Authorization outcome
          enum:
            - AUTHORIZED
            - DENIED
        authorizationCode:
          type: string
          description: Authorization code for audit (AUTH-XXXXXX format, or N/A if denied)
        message:
          type: string
          description: Human-readable description of the authorization decision

    ErrorResponse:
      type: object
      properties:
        status:
          type: integer
        error:
          type: string
        message:
          type: string
        details:
          type: array
          items:
            type: string
        timestamp:
          type: string
          format: date-time
